{"version":3,"sources":["../src/coursecard.js"],"names":["define","$","Str","Ajax","Templates","SERVICES","COURSECARD_EXTRA","COURSECARD_TEACHERS","TEMPLATES","COURSECARD_FOOTER","LOADING","CourseCard","region","courseId","identifierfooter","identifierteachers","identifiercourse","render","visible","done","request_footer","methodname","args","course_id","call","response","template","view_url","hrefs","find","each","href_current","attr","includes","html","js","runTemplateJS","fail","Notification","exception","request_teachers","prototype","node","initCourseCard"],"mappings":"AAwBAA,OAAM,wBAAC,CACC,QADD,CAEC,UAFD,CAGC,WAHD,CAIC,gBAJD,CAAD,CAKC,SAAUC,CAAV,CAAaC,CAAb,CAAkBC,CAAlB,CAAwBC,CAAxB,CAAmC,CAClC,aADkC,GAsB9BC,CAAAA,CAAQ,CAAG,CACXC,gBAAgB,CAAE,4BADP,CAEXC,mBAAmB,CAAE,+BAFV,CAtBmB,CA8B9BC,CAAS,CAAG,CACZC,iBAAiB,CAAE,6BADP,CAEZF,mBAAmB,CAAE,+BAFT,CAGZG,OAAO,CAAE,sBAHG,CA9BkB,CAyClC,QAASC,CAAAA,CAAT,CAAoBC,CAApB,CAA4BC,CAA5B,CAAsC,IAE9BC,CAAAA,CAAgB,CAAGb,CAAC,CAAC,yDAAwDY,CAAxD,CAAmE,KAApE,CAFU,CAG9BE,CAAkB,CAAGd,CAAC,CAAC,2DAA0DY,CAA1D,CAAqE,KAAtE,CAHQ,CAI9BG,CAAgB,CAAGf,CAAC,CAAC,0EAAuEY,CAAvE,CAAkF,KAAnF,CAJU,CAKlCT,CAAS,CAACa,MAAV,CAAiBT,CAAS,CAACE,OAA3B,CAAoC,CAACQ,OAAO,GAAR,CAApC,EAAqDC,IAArD,CAA0D,UAAe,CAErE,GAAIC,CAAAA,CAAc,CAAG,CACjBC,UAAU,CAAEhB,CAAQ,CAACC,gBADJ,CAEjBgB,IAAI,CAAE,CACFC,SAAS,CAAEV,CADT,CAFW,CAArB,CAMAV,CAAI,CAACqB,IAAL,CAAU,CAACJ,CAAD,CAAV,EAA4B,CAA5B,EAA+BD,IAA/B,CAAoC,SAASM,CAAT,CAAmB,IAC/CC,CAAAA,CAAQ,CAAGlB,CAAS,CAACC,iBAD0B,CAE/CkB,CAAQ,CAAGF,CAAQ,CAACE,QAF2B,CAG/CC,CAAK,CAAGZ,CAAgB,CAACa,IAAjB,CAAsB,uBAAtB,CAHuC,CAInDD,CAAK,CAACE,IAAN,CAAW,UAAW,CAClB,GAAIC,CAAAA,CAAY,CAAG9B,CAAC,CAAC,IAAD,CAAD,CAAQ+B,IAAR,CAAa,MAAb,CAAnB,CACA,GAAID,CAAY,CAACE,QAAb,CAAsB,UAAtB,CAAJ,CAAuC,CACnChC,CAAC,CAAC,IAAD,CAAD,CAAQ+B,IAAR,CAAa,MAAb,CAAqBL,CAArB,CACH,CACJ,CALD,EAMAvB,CAAS,CAACa,MAAV,CAAiBS,CAAjB,CAA2BD,CAA3B,EAAqCN,IAArC,CAA0C,SAASe,CAAT,CAAeC,CAAf,CAAmB,CACzDrB,CAAgB,CAACoB,IAAjB,CAAsBA,CAAtB,EACA9B,CAAS,CAACgC,aAAV,CAAwBD,CAAxB,CACH,CAHD,CAIH,CAdD,EAcGE,IAdH,CAcQC,YAAY,CAACC,SAdrB,EAiBA,GAAIC,CAAAA,CAAgB,CAAG,CACnBnB,UAAU,CAAEhB,CAAQ,CAACE,mBADF,CAEnBe,IAAI,CAAE,CACFC,SAAS,CAAEV,CADT,CAFa,CAAvB,CAOAV,CAAI,CAACqB,IAAL,CAAU,CAACgB,CAAD,CAAV,EAA8B,CAA9B,EAAiCrB,IAAjC,CAAsC,SAASM,CAAT,CAAmB,CACrD,GAAIC,CAAAA,CAAQ,CAAGlB,CAAS,CAACD,mBAAzB,CACAH,CAAS,CAACa,MAAV,CAAiBS,CAAjB,CAA2BD,CAA3B,EAAqCN,IAArC,CAA0C,SAASe,CAAT,CAAeC,CAAf,CAAmB,CACzDpB,CAAkB,CAACmB,IAAnB,CAAwBA,CAAxB,EACA9B,CAAS,CAACgC,aAAV,CAAwBD,CAAxB,CACH,CAHD,CAIH,CAND,EAMGE,IANH,CAMQC,YAAY,CAACC,SANrB,CAQH,CAxCD,CA0CH,CAGD5B,CAAU,CAAC8B,SAAX,CAAqBC,IAArB,CAA4B,IAA5B,CAEA,MAAO,CAMHC,cAAc,CAAE,wBAAU/B,CAAV,CAAkBC,CAAlB,CAA4B,CACxC,MAAO,IAAIF,CAAAA,CAAJ,CAAeC,CAAf,CAAuBC,CAAvB,CACV,CARE,CAUV,CA5GC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @author 2021 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/templates'\n    ], function ($, Str, Ajax, Templates) {\n        \"use strict\";\n\n        /**\n         *\n         */\n        let ACTION = {\n            LOGINBUTTON: '[data-action=\"customsso\"]',\n        };\n\n        /**\n         *\n         */\n        let REGIONS = {\n            COURSE_CONTENT: '[data-region=\"course-content\"]',\n            TEACHERS_CONTENT: '[data-region=\"coursecard-teachers-\"]',\n            FOOTER_CONTENT: '[data-region=\"coursecard-footer-\"]',\n        };\n\n        /**\n         *\n         */\n        let SERVICES = {\n            COURSECARD_EXTRA: 'theme_cbe_coursecard_extra',\n            COURSECARD_TEACHERS: 'theme_cbe_coursecard_teachers'\n        };\n\n        /**\n         *\n         */\n        let TEMPLATES = {\n            COURSECARD_FOOTER: 'theme_cbe/coursecard_footer',\n            COURSECARD_TEACHERS: 'theme_cbe/coursecard_teachers',\n            LOADING: 'core/overlay_loading'\n        };\n\n        /**\n         * @constructor\n         * @param {String} region\n         * @param {Number} courseId\n         */\n        function CourseCard(region, courseId) {\n\n            var identifierfooter = $('[data-role=\"user\"] [data-region=\"coursecard-footer-' + courseId + '\"]');\n            var identifierteachers = $('[data-role=\"user\"] [data-region=\"coursecard-teachers-' + courseId + '\"]');\n            var identifiercourse = $('[data-role=\"user\"] [data-region=\"course-content\"][data-course-id=\"' + courseId + '\"]');\n            Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                /** FOOTER **/\n                var request_footer = {\n                    methodname: SERVICES.COURSECARD_EXTRA,\n                    args: {\n                        course_id: courseId\n                    }\n                };\n                Ajax.call([request_footer])[0].done(function(response) {\n                    var template = TEMPLATES.COURSECARD_FOOTER;\n                    var view_url = response.view_url;\n                    var hrefs = identifiercourse.find('a[href*=\"/course/\"]');\n                    hrefs.each(function() {\n                        var href_current = $(this).attr('href');\n                        if (href_current.includes('/course/')) {\n                            $(this).attr('href', view_url);\n                        }\n                    });\n                    Templates.render(template, response).done(function(html, js) {\n                        identifierfooter.html(html);\n                        Templates.runTemplateJS(js);\n                    });\n                }).fail(Notification.exception);\n\n                /** TEACHERS **/\n                var request_teachers = {\n                    methodname: SERVICES.COURSECARD_TEACHERS,\n                    args: {\n                        course_id: courseId,\n                    }\n                };\n\n                Ajax.call([request_teachers])[0].done(function(response) {\n                    var template = TEMPLATES.COURSECARD_TEACHERS;\n                    Templates.render(template, response).done(function(html, js) {\n                        identifierteachers.html(html);\n                        Templates.runTemplateJS(js);\n                    });\n                }).fail(Notification.exception);\n\n            });\n\n        }\n\n        /** @type {jQuery} The jQuery node for the region. */\n        CourseCard.prototype.node = null;\n\n        return {\n            /**\n             * @param {String} region\n             * @param {Number} courseId\n             * @return {CourseCard}\n             */\n            initCourseCard: function (region, courseId) {\n                return new CourseCard(region, courseId);\n            }\n        };\n    }\n);"],"file":"coursecard.min.js"}