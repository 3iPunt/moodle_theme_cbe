{"version":3,"file":"coursecard.min.js","sources":["../src/coursecard.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @author 2021 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/templates'\n    ], function ($, Str, Ajax, Templates) {\n        \"use strict\";\n\n        /**\n         *\n         */\n        let ACTION = {\n            LOGINBUTTON: '[data-action=\"customsso\"]',\n        };\n\n        /**\n         *\n         */\n        let REGIONS = {\n            COURSE_CONTENT: '[data-region=\"course-content\"]',\n            TEACHERS_CONTENT: '[data-region=\"coursecard-teachers-\"]',\n            FOOTER_CONTENT: '[data-region=\"coursecard-footer-\"]',\n        };\n\n        /**\n         *\n         */\n        let SERVICES = {\n            COURSECARD_EXTRA: 'theme_cbe_coursecard_extra',\n            COURSECARD_TEACHERS: 'theme_cbe_coursecard_teachers'\n        };\n\n        /**\n         *\n         */\n        let TEMPLATES = {\n            COURSECARD_FOOTER: 'theme_cbe/coursecard_footer',\n            COURSECARD_TEACHERS: 'theme_cbe/coursecard_teachers',\n            LOADING: 'core/overlay_loading'\n        };\n\n        /**\n         * @constructor\n         * @param {String} region\n         * @param {Number} courseId\n         */\n        function CourseCard(region, courseId) {\n\n            var identifierfooter = $('[data-role=\"user\"] [data-region=\"coursecard-footer-' + courseId + '\"]');\n            var identifierteachers = $('[data-role=\"user\"] [data-region=\"coursecard-teachers-' + courseId + '\"]');\n            var identifiercourse = $('[data-role=\"user\"] [data-region=\"course-content\"][data-course-id=\"' + courseId + '\"]');\n            Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                /** FOOTER **/\n                var request_footer = {\n                    methodname: SERVICES.COURSECARD_EXTRA,\n                    args: {\n                        course_id: courseId\n                    }\n                };\n                Ajax.call([request_footer])[0].done(function(response) {\n                    var template = TEMPLATES.COURSECARD_FOOTER;\n                    var view_url = response.view_url;\n                    var hrefs = identifiercourse.find('a[href*=\"/course/\"]');\n                    hrefs.each(function() {\n                        var href_current = $(this).attr('href');\n                        if (href_current.includes('/course/')) {\n                            $(this).attr('href', view_url);\n                        }\n                    });\n                    Templates.render(template, response).done(function(html, js) {\n                        identifierfooter.html(html);\n                        Templates.runTemplateJS(js);\n                    });\n                }).fail(Notification.exception);\n\n                /** TEACHERS **/\n                var request_teachers = {\n                    methodname: SERVICES.COURSECARD_TEACHERS,\n                    args: {\n                        course_id: courseId,\n                    }\n                };\n\n                Ajax.call([request_teachers])[0].done(function(response) {\n                    var template = TEMPLATES.COURSECARD_TEACHERS;\n                    Templates.render(template, response).done(function(html, js) {\n                        identifierteachers.html(html);\n                        Templates.runTemplateJS(js);\n                    });\n                }).fail(Notification.exception);\n\n            });\n\n        }\n\n        /** @type {jQuery} The jQuery node for the region. */\n        CourseCard.prototype.node = null;\n\n        return {\n            /**\n             * @param {String} region\n             * @param {Number} courseId\n             * @return {CourseCard}\n             */\n            initCourseCard: function (region, courseId) {\n                return new CourseCard(region, courseId);\n            }\n        };\n    }\n);"],"names":["define","$","Str","Ajax","Templates","SERVICES","TEMPLATES","CourseCard","region","courseId","identifierfooter","identifierteachers","identifiercourse","render","visible","done","html","request_footer","methodname","args","course_id","call","response","template","view_url","find","each","this","attr","includes","js","runTemplateJS","fail","Notification","exception","request_teachers","prototype","node","initCourseCard"],"mappings":";;;;;AAwBAA,8BAAO,CACC,SACA,WACA,YACA,mBACD,SAAUC,EAAGC,IAAKC,KAAMC,eAsBnBC,0BACkB,6BADlBA,6BAEqB,gCAMrBC,4BACmB,8BADnBA,8BAEqB,gCAFrBA,kBAGS,gCAQJC,WAAWC,OAAQC,cAEpBC,iBAAmBT,EAAE,sDAAwDQ,SAAW,MACxFE,mBAAqBV,EAAE,wDAA0DQ,SAAW,MAC5FG,iBAAmBX,EAAE,qEAAuEQ,SAAW,MAC3GL,UAAUS,OAAOP,kBAAmB,CAACQ,SAAS,IAAOC,MAAK,SAASC,UAE3DC,eAAiB,CACjBC,WAAYb,0BACZc,KAAM,CACFC,UAAWX,WAGnBN,KAAKkB,KAAK,CAACJ,iBAAiB,GAAGF,MAAK,SAASO,cACrCC,SAAWjB,4BACXkB,SAAWF,SAASE,SACZZ,iBAAiBa,KAAK,uBAC5BC,MAAK,WACYzB,EAAE0B,MAAMC,KAAK,QACfC,SAAS,aACtB5B,EAAE0B,MAAMC,KAAK,OAAQJ,aAG7BpB,UAAUS,OAAOU,SAAUD,UAAUP,MAAK,SAASC,KAAMc,IACrDpB,iBAAiBM,KAAKA,MACtBZ,UAAU2B,cAAcD,UAE7BE,KAAKC,aAAaC,eAGjBC,iBAAmB,CACnBjB,WAAYb,6BACZc,KAAM,CACFC,UAAWX,WAInBN,KAAKkB,KAAK,CAACc,mBAAmB,GAAGpB,MAAK,SAASO,cACvCC,SAAWjB,8BACfF,UAAUS,OAAOU,SAAUD,UAAUP,MAAK,SAASC,KAAMc,IACrDnB,mBAAmBK,KAAKA,MACxBZ,UAAU2B,cAAcD,UAE7BE,KAAKC,aAAaC,qBAO7B3B,WAAW6B,UAAUC,KAAO,KAErB,CAMHC,eAAgB,SAAU9B,OAAQC,iBACvB,IAAIF,WAAWC,OAAQC"}