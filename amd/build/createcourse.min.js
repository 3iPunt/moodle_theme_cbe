/**
 *
 * @author  2021 3iPunt <https://www.tresipunt.com/>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_cbe/createcourse",["jquery","core/str","core/ajax","core/templates"],(function($,Str,Ajax,Templates){var ACTION_CREATE_BUTTON='[data-action="create"]',FORM_ALL_INPUTS=".validation-input",FORM_FULLNAME_INPUT="#fullname",FORM_SHORTNAME_INPUT="#shortname",FORM_CATEGORY_SELECT="#category",FORM_VISIBLE_CHECK="#visible",MSG_SHORTNAME='[data-msg="msg-shortname"]',VERYFY_CHECK_FULLNAME_OK="#verify-fullname .fa-check-circle-o",VERYFY_CHECK_FULLNAME_KO="#verify-fullname .fa-times-circle-o",VERYFY_CHECK_SHORTNAME_OK="#verify-shortname .fa-check-circle-o",VERYFY_CHECK_SHORTNAME_KO="#verify-shortname .fa-times-circle-o",VERYFY_CHECK_CATEGORY_OK="#verify-category .fa-check-circle-o",VERYFY_CHECK_CATEGORY_KO="#verify-category .fa-times-circle-o",SERVICES_CREATE_COURSE="theme_cbe_create_course",SERVICES_CHECK_COURSE_SHORTNAME="theme_cbe_check_course_shortname",VALIDATION={fullname:!1,shortname:!1,category:!1};function CreateCourse(region,has_uniquename){this.node=$(region),this.has_uniquename=has_uniquename,this.fullname=FORM_FULLNAME_INPUT,this.shortname=FORM_SHORTNAME_INPUT,this.category=FORM_CATEGORY_SELECT,this.all_inputs=FORM_ALL_INPUTS,this.has_uniquename?VALIDATION.fullname=!0:this.node.find(this.fullname).on("change",this.onFullnameChange.bind(this)),this.node.find(this.shortname).on("keyup",this.onShortnameChange.bind(this)),this.node.find(this.category).on("change",this.onCategoryChange.bind(this)),this.node.find(this.all_inputs).on("change",this.onAllInputsChange.bind(this)),this.node.find(ACTION_CREATE_BUTTON).on("click",this.onCreateCourseButtonClick.bind(this))}return CreateCourse.prototype.onAllInputsChange=function(e){VALIDATION.fullname&&VALIDATION.shortname&&VALIDATION.category?$(ACTION_CREATE_BUTTON).prop("disabled",!1):$(ACTION_CREATE_BUTTON).prop("disabled",!0)},CreateCourse.prototype.onCategoryChange=function(e){this.node.find(this.category).val().trim()>0?(VALIDATION.category=!0,$(VERYFY_CHECK_CATEGORY_OK).show(),$(VERYFY_CHECK_CATEGORY_KO).hide()):(VALIDATION.category=!1,$(VERYFY_CHECK_CATEGORY_OK).hide(),$(VERYFY_CHECK_CATEGORY_KO).show())},CreateCourse.prototype.onFullnameChange=function(e){""!==this.node.find(this.fullname).val().trim()?(VALIDATION.fullname=!0,$(VERYFY_CHECK_FULLNAME_OK).show(),$(VERYFY_CHECK_FULLNAME_KO).hide()):(VALIDATION.fullname=!1,$(VERYFY_CHECK_FULLNAME_KO).show(),$(VERYFY_CHECK_FULLNAME_OK).hide())},CreateCourse.prototype.onShortnameChange=function(e){var shortname=$(FORM_SHORTNAME_INPUT).val().trim();if(this.node.find(this.shortname).val().length>3){var request={methodname:SERVICES_CHECK_COURSE_SHORTNAME,args:{shortname:shortname}};Ajax.call([request])[0].done((function(response){response.exist?(VALIDATION.shortname=!1,$(MSG_SHORTNAME).text(response.msg),$(VERYFY_CHECK_SHORTNAME_KO).show(),$(VERYFY_CHECK_SHORTNAME_OK).hide(),VALIDATION.fullname&&VALIDATION.shortname&&VALIDATION.category?$(ACTION_CREATE_BUTTON).prop("disabled",!1):$(ACTION_CREATE_BUTTON).prop("disabled",!0)):($(VERYFY_CHECK_SHORTNAME_OK).show(),$(VERYFY_CHECK_SHORTNAME_KO).hide(),$(MSG_SHORTNAME).text(""),VALIDATION.shortname=!0,VALIDATION.fullname&&VALIDATION.shortname&&VALIDATION.category?$(ACTION_CREATE_BUTTON).prop("disabled",!1):$(ACTION_CREATE_BUTTON).prop("disabled",!0))})).fail(Notification.exception)}else VALIDATION.shortname=!1,$(VERYFY_CHECK_SHORTNAME_KO).show(),$(VERYFY_CHECK_SHORTNAME_OK).hide()},CreateCourse.prototype.onCreateCourseButtonClick=function(e){$(ACTION_CREATE_BUTTON).prop("disabled",!0);var fullname="";fullname=this.has_uniquename?$(FORM_SHORTNAME_INPUT).val().trim():$(FORM_FULLNAME_INPUT).val().trim();var shortname=$(FORM_SHORTNAME_INPUT).val().trim(),category=$(FORM_CATEGORY_SELECT).val(),visible=$(FORM_VISIBLE_CHECK).is(":checked")?1:0,request={methodname:SERVICES_CREATE_COURSE,args:{fullname:fullname,shortname:shortname,category:category,visible:visible}};Ajax.call([request])[0].done((function(response){response.success?location.href=response.redirect:alert(response.error)})).fail(Notification.exception)},CreateCourse.prototype.node=null,{initCreateCourse:function(region,has_uniquename){return new CreateCourse(region,has_uniquename)}}}));

//# sourceMappingURL=createcourse.min.js.map