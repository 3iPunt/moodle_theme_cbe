{"version":3,"file":"publication.min.js","sources":["../src/publication.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @author  2021 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/templates'\n    ], function ($, Str, Ajax, Templates) {\n        \"use strict\";\n\n        /**\n         *\n         */\n        let ACTION = {\n            PUBLICATION_BUTTON: '[data-action=\"publicate\"]',\n            ALUMN_SELECT: '[data-action=\"alumn\"]',\n            GROUP_SELECT: '[data-action=\"group\"]',\n        };\n\n        let TEXT = {\n            COMMENT_TEXT: '[data-text=\"comment\"]',\n        };\n\n        /**\n         *\n         */\n        let SERVICES = {\n            MODULE_PUBLICATION: 'theme_cbe_publication'\n        };\n\n        /**\n         * @constructor\n         * @param {String} region\n         * @param {Number} courseId\n         */\n        function Publication(region, courseId) {\n            this.courseid = courseId;\n            this.node = $(region);\n            this.node.find(ACTION.ALUMN_SELECT).on('change', this.onAlumnSelectChange.bind(this));\n            this.node.find(ACTION.GROUP_SELECT).on('change', this.onGroupSelectChange.bind(this));\n            this.node.find(TEXT.COMMENT_TEXT).on('keyup', this.onCommentTextKeyUp.bind(this));\n            this.node.find(ACTION.PUBLICATION_BUTTON).on('click', this.onPublicationButtonClick.bind(this));\n        }\n\n        Publication.prototype.onCommentTextKeyUp = function (e) {\n            if (this.node.find(TEXT.COMMENT_TEXT).val().trim() !== '') {\n                $(ACTION.PUBLICATION_BUTTON).prop( \"disabled\", false );\n            } else {\n                $(ACTION.PUBLICATION_BUTTON).prop( \"disabled\", true );\n            }\n        };\n\n        Publication.prototype.onAlumnSelectChange = function (e) {\n            this.node.find(ACTION.GROUP_SELECT).val(0);\n        };\n\n        Publication.prototype.onGroupSelectChange = function (e) {\n            this.node.find(ACTION.ALUMN_SELECT).val(0);\n        };\n\n        Publication.prototype.onPublicationButtonClick = function (e) {\n            $(ACTION.PUBLICATION_BUTTON).prop( \"disabled\", true );\n            var comment = $(TEXT.COMMENT_TEXT).val();\n            var student = this.node.find(ACTION.ALUMN_SELECT).val();\n            var group = this.node.find(ACTION.GROUP_SELECT).val();\n            var mode = 'all';\n            var item = 0;\n            if (student > 0) {\n                mode = 'student';\n                item = parseInt(student);\n            }\n            if (group > 0) {\n                mode = 'group';\n                item = parseInt(group);\n            }\n            var request = {\n                methodname: SERVICES.MODULE_PUBLICATION,\n                args: {\n                    course_id: this.courseid,\n                    comment: comment,\n                    mode: mode,\n                    item: item\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                location.reload();\n            }).fail(Notification.exception);\n        };\n\n        /** @type {jQuery} The jQuery node for the region. */\n        Publication.prototype.node = null;\n\n        return {\n            /**\n             * @param {String} region\n             * @param {Number} courseId\n             * @return {Publication}\n             */\n            initPublication: function (region, courseId) {\n                return new Publication(region, courseId);\n            }\n        };\n    }\n);"],"names":["define","$","Str","Ajax","Templates","ACTION","TEXT","SERVICES","Publication","region","courseId","courseid","node","find","on","this","onAlumnSelectChange","bind","onGroupSelectChange","onCommentTextKeyUp","onPublicationButtonClick","prototype","e","val","trim","prop","comment","student","group","mode","item","parseInt","request","methodname","args","course_id","call","done","response","location","reload","fail","Notification","exception","initPublication"],"mappings":";;;;;AAwBAA,+BAAO,CACC,SACA,WACA,YACA,mBACD,SAAUC,EAAGC,IAAKC,KAAMC,eAMnBC,0BACoB,4BADpBA,oBAEc,wBAFdA,oBAGc,wBAGdC,kBACc,wBAMdC,4BACoB,iCAQfC,YAAYC,OAAQC,eACpBC,SAAWD,cACXE,KAAOX,EAAEQ,aACTG,KAAKC,KAAKR,qBAAqBS,GAAG,SAAUC,KAAKC,oBAAoBC,KAAKF,YAC1EH,KAAKC,KAAKR,qBAAqBS,GAAG,SAAUC,KAAKG,oBAAoBD,KAAKF,YAC1EH,KAAKC,KAAKP,mBAAmBQ,GAAG,QAASC,KAAKI,mBAAmBF,KAAKF,YACtEH,KAAKC,KAAKR,2BAA2BS,GAAG,QAASC,KAAKK,yBAAyBH,KAAKF,cAG7FP,YAAYa,UAAUF,mBAAqB,SAAUG,GACM,KAAnDP,KAAKH,KAAKC,KAAKP,mBAAmBiB,MAAMC,OACxCvB,EAAEI,2BAA2BoB,KAAM,YAAY,GAE/CxB,EAAEI,2BAA2BoB,KAAM,YAAY,IAIvDjB,YAAYa,UAAUL,oBAAsB,SAAUM,QAC7CV,KAAKC,KAAKR,qBAAqBkB,IAAI,IAG5Cf,YAAYa,UAAUH,oBAAsB,SAAUI,QAC7CV,KAAKC,KAAKR,qBAAqBkB,IAAI,IAG5Cf,YAAYa,UAAUD,yBAA2B,SAAUE,GACvDrB,EAAEI,2BAA2BoB,KAAM,YAAY,OAC3CC,QAAUzB,EAAEK,mBAAmBiB,MAC/BI,QAAUZ,KAAKH,KAAKC,KAAKR,qBAAqBkB,MAC9CK,MAAQb,KAAKH,KAAKC,KAAKR,qBAAqBkB,MAC5CM,KAAO,MACPC,KAAO,EACPH,QAAU,IACVE,KAAO,UACPC,KAAOC,SAASJ,UAEhBC,MAAQ,IACRC,KAAO,QACPC,KAAOC,SAASH,YAEhBI,QAAU,CACVC,WAAY1B,4BACZ2B,KAAM,CACFC,UAAWpB,KAAKJ,SAChBe,QAASA,QACTG,KAAMA,KACNC,KAAMA,OAGd3B,KAAKiC,KAAK,CAACJ,UAAU,GAAGK,MAAK,SAASC,UAClCC,SAASC,YACVC,KAAKC,aAAaC,YAIzBnC,YAAYa,UAAUT,KAAO,KAEtB,CAMHgC,gBAAiB,SAAUnC,OAAQC,iBACxB,IAAIF,YAAYC,OAAQC"}