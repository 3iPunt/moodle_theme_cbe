{"version":3,"sources":["../src/createcourse.js"],"names":["define","$","Str","Ajax","ACTION","CREATE_BUTTON","FORM","ALL_INPUTS","FULLNAME_INPUT","SHORTNAME_INPUT","CATEGORY_SELECT","VISIBLE_CHECK","MSG","SHORTNAME","VERYFY_CHECK","FULLNAME_OK","FULLNAME_KO","SHORTNAME_OK","SHORTNAME_KO","SERVICES","CREATE_COURSE","CHECK_COURSE_SHORTNAME","VALIDATION","CreateCourse","region","has_uniquename","node","fullname","shortname","all_inputs","find","on","onFullnameChange","bind","onShortnameFocusOut","onAllInputsFocusOut","onCreateCourseButtonClick","prototype","prop","val","trim","show","hide","request","methodname","args","call","done","response","exist","text","msg","fail","Notification","exception","category","visible","is","success","location","href","redirect","alert","error","initCreateCourse"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package theme_cbe\n * @author  2021 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/templates'\n    ], function ($, Str, Ajax, Templates) {\n        \"use strict\";\n\n        let ACTION = {\n            CREATE_BUTTON: '[data-action=\"create\"]',\n        };\n\n        let FORM = {\n            ALL_INPUTS: '.validation-input',\n            FULLNAME_INPUT: '#fullname',\n            SHORTNAME_INPUT: '#shortname',\n            CATEGORY_SELECT: '#category',\n            VISIBLE_CHECK: '#visible',\n        };\n\n        let MSG = {\n            SHORTNAME: '[data-msg=\"msg-shortname\"]',\n        };\n\n        let VERYFY_CHECK = {\n            FULLNAME_OK: '#verify-fullname .fa-check-circle-o',\n            FULLNAME_KO: '#verify-fullname .fa-times-circle-o',\n            SHORTNAME_OK: '#verify-shortname .fa-check-circle-o',\n            SHORTNAME_KO: '#verify-shortname .fa-times-circle-o'\n        };\n\n        let SERVICES = {\n            CREATE_COURSE: 'theme_cbe_create_course',\n            CHECK_COURSE_SHORTNAME: 'theme_cbe_check_course_shortname',\n        };\n\n        let VALIDATION = {\n            'fullname': false,\n            'shortname': false\n        };\n\n        /**\n         * @constructor\n         * @param {String} region\n         * @param {boolean} has_uniquename\n         */\n        function CreateCourse(region, has_uniquename) {\n            this.node = $(region);\n            this.has_uniquename = has_uniquename;\n            this.fullname = FORM.FULLNAME_INPUT;\n            this.shortname = FORM.SHORTNAME_INPUT;\n            this.all_inputs = FORM.ALL_INPUTS;\n            if (!this.has_uniquename) {\n                this.node.find(this.fullname).on('keyup', this.onFullnameChange.bind(this));\n            } else {\n                VALIDATION.fullname = true;\n            }\n            this.node.find(this.shortname).on('focusout', this.onShortnameFocusOut.bind(this));\n            this.node.find(this.all_inputs).on('focusout', this.onAllInputsFocusOut.bind(this));\n            this.node.find(ACTION.CREATE_BUTTON).on('click', this.onCreateCourseButtonClick.bind(this));\n        }\n\n        CreateCourse.prototype.onAllInputsFocusOut = function (e) {\n            if (VALIDATION.fullname && VALIDATION.shortname) {\n                $(ACTION.CREATE_BUTTON).prop( \"disabled\", false );\n            } else {\n                $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n            }\n        };\n\n        CreateCourse.prototype.onFullnameChange = function (e) {\n            if (this.node.find(this.fullname).val().trim() !== '') {\n                VALIDATION.fullname = true;\n                $(VERYFY_CHECK.FULLNAME_OK).show();\n                $(VERYFY_CHECK.FULLNAME_KO).hide();\n            } else {\n                VALIDATION.fullname = false;\n                $(VERYFY_CHECK.FULLNAME_KO).show();\n                $(VERYFY_CHECK.FULLNAME_OK).hide();\n            }\n        };\n\n        CreateCourse.prototype.onShortnameFocusOut = function (e) {\n            const shortname = $(FORM.SHORTNAME_INPUT).val().trim();\n            if (this.node.find(this.shortname).val().trim() !== '') {\n                const request = {\n                    methodname: SERVICES.CHECK_COURSE_SHORTNAME,\n                    args: {\n                        shortname: shortname\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.exist) {\n                        VALIDATION.shortname = false;\n                        $(MSG.SHORTNAME).text(response.msg);\n                        $(VERYFY_CHECK.SHORTNAME_KO).show();\n                        $(VERYFY_CHECK.SHORTNAME_OK).hide();\n                    } else {\n                        $(VERYFY_CHECK.SHORTNAME_OK).show();\n                        $(VERYFY_CHECK.SHORTNAME_KO).hide();\n                        $(MSG.SHORTNAME).text('');\n                        VALIDATION.shortname = true;\n                    }\n                }).fail(Notification.exception);\n            } else {\n                VALIDATION.shortname = false;\n            }\n        };\n\n        CreateCourse.prototype.onCreateCourseButtonClick = function (e) {\n            $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n            let fullname = '';\n            if (!this.has_uniquename) {\n                fullname = $(FORM.FULLNAME_INPUT).val().trim();\n            } else {\n                fullname = $(FORM.SHORTNAME_INPUT).val().trim();\n            }\n            const shortname = $(FORM.SHORTNAME_INPUT).val().trim();\n            const category = $(FORM.CATEGORY_SELECT).val();\n            const visible = $(FORM.VISIBLE_CHECK).is(\":checked\") ? 1 : 0;\n            const request = {\n                methodname: SERVICES.CREATE_COURSE,\n                args: {\n                    fullname: fullname,\n                    shortname: shortname,\n                    category: category,\n                    visible: visible\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.success) {\n                    location.href = response.redirect;\n                } else {\n                    alert(response.error);\n                }\n            }).fail(Notification.exception);\n        };\n\n        /** @type {jQuery} The jQuery node for the region. */\n        CreateCourse.prototype.node = null;\n\n        return {\n            /**\n             * @param {String} region\n             * @param {boolean} has_uniquename\n             * @return {CreateCourse}\n             */\n            initCreateCourse: function (region, has_uniquename) {\n                return new CreateCourse(region, has_uniquename);\n            }\n        };\n    }\n);"],"file":"createcourse.min.js"}