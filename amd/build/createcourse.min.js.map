{"version":3,"sources":["../src/createcourse.js"],"names":["define","$","Str","Ajax","ACTION","CREATE_BUTTON","FORM","ALL_INPUTS","FULLNAME_INPUT","SHORTNAME_INPUT","CATEGORY_SELECT","VISIBLE_CHECK","MSG","SHORTNAME","VERYFY_CHECK","FULLNAME_OK","FULLNAME_KO","SHORTNAME_OK","SHORTNAME_KO","CATEGORY_OK","CATEGORY_KO","SERVICES","CREATE_COURSE","CHECK_COURSE_SHORTNAME","VALIDATION","CreateCourse","region","has_uniquename","node","fullname","shortname","category","all_inputs","find","on","onFullnameChange","bind","onShortnameChange","onCategoryChange","onAllInputsChange","onCreateCourseButtonClick","prototype","prop","val","trim","show","hide","length","request","methodname","args","call","done","response","exist","text","msg","fail","Notification","exception","visible","is","success","location","href","redirect","alert","error","initCreateCourse"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @author  2021 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/templates'\n    ], function ($, Str, Ajax, Templates) {\n        \"use strict\";\n\n        let ACTION = {\n            CREATE_BUTTON: '[data-action=\"create\"]',\n        };\n\n        let FORM = {\n            ALL_INPUTS: '.validation-input',\n            FULLNAME_INPUT: '#fullname',\n            SHORTNAME_INPUT: '#shortname',\n            CATEGORY_SELECT: '#category',\n            VISIBLE_CHECK: '#visible',\n        };\n\n        let MSG = {\n            SHORTNAME: '[data-msg=\"msg-shortname\"]',\n        };\n\n        let VERYFY_CHECK = {\n            FULLNAME_OK: '#verify-fullname .fa-check-circle-o',\n            FULLNAME_KO: '#verify-fullname .fa-times-circle-o',\n            SHORTNAME_OK: '#verify-shortname .fa-check-circle-o',\n            SHORTNAME_KO: '#verify-shortname .fa-times-circle-o',\n            CATEGORY_OK: '#verify-category .fa-check-circle-o',\n            CATEGORY_KO: '#verify-category .fa-times-circle-o'\n        };\n\n        let SERVICES = {\n            CREATE_COURSE: 'theme_cbe_create_course',\n            CHECK_COURSE_SHORTNAME: 'theme_cbe_check_course_shortname',\n        };\n\n        let VALIDATION = {\n            'fullname': false,\n            'shortname': false,\n            'category': false\n        };\n\n        /**\n         * @constructor\n         * @param {String} region\n         * @param {boolean} has_uniquename\n         */\n        function CreateCourse(region, has_uniquename) {\n            this.node = $(region);\n            this.has_uniquename = has_uniquename;\n            this.fullname = FORM.FULLNAME_INPUT;\n            this.shortname = FORM.SHORTNAME_INPUT;\n            this.category = FORM.CATEGORY_SELECT;\n            this.all_inputs = FORM.ALL_INPUTS;\n            if (!this.has_uniquename) {\n                this.node.find(this.fullname).on('change', this.onFullnameChange.bind(this));\n            } else {\n                VALIDATION.fullname = true;\n            }\n            this.node.find(this.shortname).on('keyup', this.onShortnameChange.bind(this));\n            this.node.find(this.category).on('change', this.onCategoryChange.bind(this));\n            this.node.find(this.all_inputs).on('change', this.onAllInputsChange.bind(this));\n            this.node.find(ACTION.CREATE_BUTTON).on('click', this.onCreateCourseButtonClick.bind(this));\n        }\n\n        CreateCourse.prototype.onAllInputsChange = function (e) {\n            if (VALIDATION.fullname && VALIDATION.shortname && VALIDATION.category) {\n                $(ACTION.CREATE_BUTTON).prop( \"disabled\", false );\n            } else {\n                $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n            }\n        };\n\n        CreateCourse.prototype.onCategoryChange = function (e) {\n            if (this.node.find(this.category).val().trim() > 0) {\n                VALIDATION.category = true;\n                $(VERYFY_CHECK.CATEGORY_OK).show();\n                $(VERYFY_CHECK.CATEGORY_KO).hide();\n            } else {\n                VALIDATION.category = false;\n                $(VERYFY_CHECK.CATEGORY_OK).hide();\n                $(VERYFY_CHECK.CATEGORY_KO).show();\n            }\n        };\n\n        CreateCourse.prototype.onFullnameChange = function (e) {\n            if (this.node.find(this.fullname).val().trim() !== '') {\n                VALIDATION.fullname = true;\n                $(VERYFY_CHECK.FULLNAME_OK).show();\n                $(VERYFY_CHECK.FULLNAME_KO).hide();\n            } else {\n                VALIDATION.fullname = false;\n                $(VERYFY_CHECK.FULLNAME_KO).show();\n                $(VERYFY_CHECK.FULLNAME_OK).hide();\n            }\n        };\n\n        CreateCourse.prototype.onShortnameChange = function (e) {\n            const shortname = $(FORM.SHORTNAME_INPUT).val().trim();\n            if (this.node.find(this.shortname).val().length > 3) {\n                const request = {\n                    methodname: SERVICES.CHECK_COURSE_SHORTNAME,\n                    args: {\n                        shortname: shortname\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.exist) {\n                        VALIDATION.shortname = false;\n                        $(MSG.SHORTNAME).text(response.msg);\n                        $(VERYFY_CHECK.SHORTNAME_KO).show();\n                        $(VERYFY_CHECK.SHORTNAME_OK).hide();\n                        if (VALIDATION.fullname && VALIDATION.shortname && VALIDATION.category) {\n                            $(ACTION.CREATE_BUTTON).prop( \"disabled\", false );\n                        } else {\n                            $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n                        }\n                    } else {\n                        $(VERYFY_CHECK.SHORTNAME_OK).show();\n                        $(VERYFY_CHECK.SHORTNAME_KO).hide();\n                        $(MSG.SHORTNAME).text('');\n                        VALIDATION.shortname = true;\n                        if (VALIDATION.fullname && VALIDATION.shortname && VALIDATION.category) {\n                            $(ACTION.CREATE_BUTTON).prop( \"disabled\", false );\n                        } else {\n                            $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n                        }\n                    }\n                }).fail(Notification.exception);\n            } else {\n                VALIDATION.shortname = false;\n                $(VERYFY_CHECK.SHORTNAME_KO).show();\n                $(VERYFY_CHECK.SHORTNAME_OK).hide();\n            }\n        };\n\n        CreateCourse.prototype.onCreateCourseButtonClick = function (e) {\n            $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n            let fullname = '';\n            if (!this.has_uniquename) {\n                fullname = $(FORM.FULLNAME_INPUT).val().trim();\n            } else {\n                fullname = $(FORM.SHORTNAME_INPUT).val().trim();\n            }\n            const shortname = $(FORM.SHORTNAME_INPUT).val().trim();\n            const category = $(FORM.CATEGORY_SELECT).val();\n            const visible = $(FORM.VISIBLE_CHECK).is(\":checked\") ? 1 : 0;\n            const request = {\n                methodname: SERVICES.CREATE_COURSE,\n                args: {\n                    fullname: fullname,\n                    shortname: shortname,\n                    category: category,\n                    visible: visible\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.success) {\n                    location.href = response.redirect;\n                } else {\n                    alert(response.error);\n                }\n            }).fail(Notification.exception);\n        };\n\n        /** @type {jQuery} The jQuery node for the region. */\n        CreateCourse.prototype.node = null;\n\n        return {\n            /**\n             * @param {String} region\n             * @param {boolean} has_uniquename\n             * @return {CreateCourse}\n             */\n            initCreateCourse: function (region, has_uniquename) {\n                return new CreateCourse(region, has_uniquename);\n            }\n        };\n    }\n);"],"file":"createcourse.min.js"}