{"version":3,"file":"createcourse.min.js","sources":["../src/createcourse.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @author  2021 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/templates'\n    ], function ($, Str, Ajax, Templates) {\n        \"use strict\";\n\n        let ACTION = {\n            CREATE_BUTTON: '[data-action=\"create\"]',\n        };\n\n        let FORM = {\n            ALL_INPUTS: '.validation-input',\n            FULLNAME_INPUT: '#fullname',\n            SHORTNAME_INPUT: '#shortname',\n            CATEGORY_SELECT: '#category',\n            VISIBLE_CHECK: '#visible',\n        };\n\n        let MSG = {\n            SHORTNAME: '[data-msg=\"msg-shortname\"]',\n        };\n\n        let VERYFY_CHECK = {\n            FULLNAME_OK: '#verify-fullname .fa-check-circle-o',\n            FULLNAME_KO: '#verify-fullname .fa-times-circle-o',\n            SHORTNAME_OK: '#verify-shortname .fa-check-circle-o',\n            SHORTNAME_KO: '#verify-shortname .fa-times-circle-o',\n            CATEGORY_OK: '#verify-category .fa-check-circle-o',\n            CATEGORY_KO: '#verify-category .fa-times-circle-o'\n        };\n\n        let SERVICES = {\n            CREATE_COURSE: 'theme_cbe_create_course',\n            CHECK_COURSE_SHORTNAME: 'theme_cbe_check_course_shortname',\n        };\n\n        let VALIDATION = {\n            'fullname': false,\n            'shortname': false,\n            'category': false\n        };\n\n        /**\n         * @constructor\n         * @param {String} region\n         * @param {boolean} has_uniquename\n         */\n        function CreateCourse(region, has_uniquename) {\n            this.node = $(region);\n            this.has_uniquename = has_uniquename;\n            this.fullname = FORM.FULLNAME_INPUT;\n            this.shortname = FORM.SHORTNAME_INPUT;\n            this.category = FORM.CATEGORY_SELECT;\n            this.all_inputs = FORM.ALL_INPUTS;\n            if (!this.has_uniquename) {\n                this.node.find(this.fullname).on('change', this.onFullnameChange.bind(this));\n            } else {\n                VALIDATION.fullname = true;\n            }\n            this.node.find(this.shortname).on('keyup', this.onShortnameChange.bind(this));\n            this.node.find(this.category).on('change', this.onCategoryChange.bind(this));\n            this.node.find(this.all_inputs).on('change', this.onAllInputsChange.bind(this));\n            this.node.find(ACTION.CREATE_BUTTON).on('click', this.onCreateCourseButtonClick.bind(this));\n        }\n\n        CreateCourse.prototype.onAllInputsChange = function (e) {\n            if (VALIDATION.fullname && VALIDATION.shortname && VALIDATION.category) {\n                $(ACTION.CREATE_BUTTON).prop( \"disabled\", false );\n            } else {\n                $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n            }\n        };\n\n        CreateCourse.prototype.onCategoryChange = function (e) {\n            if (this.node.find(this.category).val().trim() > 0) {\n                VALIDATION.category = true;\n                $(VERYFY_CHECK.CATEGORY_OK).show();\n                $(VERYFY_CHECK.CATEGORY_KO).hide();\n            } else {\n                VALIDATION.category = false;\n                $(VERYFY_CHECK.CATEGORY_OK).hide();\n                $(VERYFY_CHECK.CATEGORY_KO).show();\n            }\n        };\n\n        CreateCourse.prototype.onFullnameChange = function (e) {\n            if (this.node.find(this.fullname).val().trim() !== '') {\n                VALIDATION.fullname = true;\n                $(VERYFY_CHECK.FULLNAME_OK).show();\n                $(VERYFY_CHECK.FULLNAME_KO).hide();\n            } else {\n                VALIDATION.fullname = false;\n                $(VERYFY_CHECK.FULLNAME_KO).show();\n                $(VERYFY_CHECK.FULLNAME_OK).hide();\n            }\n        };\n\n        CreateCourse.prototype.onShortnameChange = function (e) {\n            const shortname = $(FORM.SHORTNAME_INPUT).val().trim();\n            if (this.node.find(this.shortname).val().length > 3) {\n                const request = {\n                    methodname: SERVICES.CHECK_COURSE_SHORTNAME,\n                    args: {\n                        shortname: shortname\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.exist) {\n                        VALIDATION.shortname = false;\n                        $(MSG.SHORTNAME).text(response.msg);\n                        $(VERYFY_CHECK.SHORTNAME_KO).show();\n                        $(VERYFY_CHECK.SHORTNAME_OK).hide();\n                        if (VALIDATION.fullname && VALIDATION.shortname && VALIDATION.category) {\n                            $(ACTION.CREATE_BUTTON).prop( \"disabled\", false );\n                        } else {\n                            $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n                        }\n                    } else {\n                        $(VERYFY_CHECK.SHORTNAME_OK).show();\n                        $(VERYFY_CHECK.SHORTNAME_KO).hide();\n                        $(MSG.SHORTNAME).text('');\n                        VALIDATION.shortname = true;\n                        if (VALIDATION.fullname && VALIDATION.shortname && VALIDATION.category) {\n                            $(ACTION.CREATE_BUTTON).prop( \"disabled\", false );\n                        } else {\n                            $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n                        }\n                    }\n                }).fail(Notification.exception);\n            } else {\n                VALIDATION.shortname = false;\n                $(VERYFY_CHECK.SHORTNAME_KO).show();\n                $(VERYFY_CHECK.SHORTNAME_OK).hide();\n            }\n        };\n\n        CreateCourse.prototype.onCreateCourseButtonClick = function (e) {\n            $(ACTION.CREATE_BUTTON).prop( \"disabled\", true );\n            let fullname = '';\n            if (!this.has_uniquename) {\n                fullname = $(FORM.FULLNAME_INPUT).val().trim();\n            } else {\n                fullname = $(FORM.SHORTNAME_INPUT).val().trim();\n            }\n            const shortname = $(FORM.SHORTNAME_INPUT).val().trim();\n            const category = $(FORM.CATEGORY_SELECT).val();\n            const visible = $(FORM.VISIBLE_CHECK).is(\":checked\") ? 1 : 0;\n            const request = {\n                methodname: SERVICES.CREATE_COURSE,\n                args: {\n                    fullname: fullname,\n                    shortname: shortname,\n                    category: category,\n                    visible: visible\n                }\n            };\n            Ajax.call([request])[0].done(function(response) {\n                if (response.success) {\n                    location.href = response.redirect;\n                } else {\n                    alert(response.error);\n                }\n            }).fail(Notification.exception);\n        };\n\n        /** @type {jQuery} The jQuery node for the region. */\n        CreateCourse.prototype.node = null;\n\n        return {\n            /**\n             * @param {String} region\n             * @param {boolean} has_uniquename\n             * @return {CreateCourse}\n             */\n            initCreateCourse: function (region, has_uniquename) {\n                return new CreateCourse(region, has_uniquename);\n            }\n        };\n    }\n);"],"names":["define","$","Str","Ajax","Templates","ACTION","FORM","MSG","VERYFY_CHECK","SERVICES","VALIDATION","CreateCourse","region","has_uniquename","node","fullname","shortname","category","all_inputs","this","find","on","onFullnameChange","bind","onShortnameChange","onCategoryChange","onAllInputsChange","onCreateCourseButtonClick","prototype","e","prop","val","trim","show","hide","length","request","methodname","args","call","done","response","exist","text","msg","fail","Notification","exception","visible","is","success","location","href","redirect","alert","error","initCreateCourse"],"mappings":"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"}